<!DOCTYPE html>
<html>
  <head>
    <title>OpenStack Upgrades</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="slides.css"></link>
  </head>
  <body>
    <textarea id="source">

class: center, middle, inverse

# OpenStack Upgrades

---
 
## Overview

Three upgrade scenarios:

1. Upgrade everything at once

2. Upgrade one service at a time

3. Upgrade one service at time with a parallel Havana Nova
   environment.

---
 
## Scenario 1: Everything at once

- Simple because there's no orchestration involved
- Good for development or POC environments
- Not so good for real deployments because of extended downtime

---

## Scenario 1: Everything at once

- Generally looks like:

        openstack-service stop
        yum upgrade
        upgrade-all-the-databases
        openstack-service start

---

## Scenario 2: Everything, one at a time

- Instead of one major service interruption...
- ...lots of smaller ones.  Yay!
- Schedule Nova upgrade separately from other services

---

## Scenario 2: Everything, one at a time

- Generally looks like:

      openstack-service stop keystone
      yum upgrade *keystone*
      keystone-manage db_sync
      openstack-service start keystone

---

## Scenario 2: Everything, one at a time

- This is a great way to spot package dependency problems.

---
 
## Scenario 3: Parallel Nova

- Like scenario 2, except for Nova
- Deploy Havana Nova environment on new hardware
- Maximizes availability of compute service
- Requires additional hardware

---
 
## Scenario 3: Parallel Nova

- Migrate workloads through attrition, or
- Migrate workloads via snapshot-delete-boot
- Havana Nova can see snapshots created in Grizzly Nova
  (sharing Glance, Cinder, Neutron, Swift, etc)

---
 
## Scenario 3: Parallel Nova

- New Nova environment is set up in Keystone as a new region.
  - New endpoint for compute
  - New endpoint for volume
- CLI tools are happy (with --os-region-name or `OS_REGION_NAME`)
- Horizon not so much

---
 
## Scenario 3: Parallel Nova

Migrating an instance looks like:

    nova --os-region-name oldregion \
      image-create <instance> <instance>_migrate
    nova --os-region-name oldregion \
      delete <instance>
    nova --os-region-name newregion \
      boot --image <instance>_migrate ... <instance>
    nova --os-region-name newregion \
      add-floating-ip <instance> <ipaddr>

---
 
## Scenario 3: Parallel Nova

- Reinstall Grizzly compute nodes as Havana compute nodes
  after all workloads are gone

Not tested:

- Volume service
- Nova networking

---
 
## Upgrading Quantum to Neutron

- **What were they thinking?**
- Configuration files have all changed location
- Python modules have all changed names
- Configuration files *include* names of Python modules

---
 
## Upgrading Quantum to Neutron

Neutron code doesn't know anything about old config files. So:

![Upgrading quantum][upgrade-quantum]

[upgrade-quantum]: upgrade-quantum.svg

---
 
## Upgrading Quantum to Neutron

- **What were they thinking?**
- Quantum database has no versioning information 
  until you explicitly put it there
- So nothing as simple as `neutron-manage db sync`.
- Starting Neutron before database upgrade can break database

---
 
## Upgrading Quantum to Neutron

Checking database version:

    neutron-db-manage --config-file /etc/neutron/neutron.conf \
      --config-file /etc/neutron/plugin.ini current

Setting database version:

    neutron-db-manage --config-file /etc/neutron/neutron.conf \
      --config-file /etc/neutron/plugin.ini stamp grizzly

---

## Upgrading Quantum to Neutron

Upgrading database:

    neutron-db-manage --config-file /etc/neutron/neutron.conf \
      --config-file /etc/neutron/plugin.ini upgrade head

---

## Upgrading Quantum to Neutron

- New `openstack-neutron` packages take much of the pain away
- Quantum client seems happy talking to Neutron server

---
 
## Upgrading Horizon

- `local_settings` substantially different between Grizzly and Havana
  packages
- Requires manual inspection

---

## Documentation

Extended documentation available [here][].

[here]: http://shell.bos.redhat.com/~lkellogg/rhos-upgrade-docs/


    </textarea>
    <script src="remark-0.5.9.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create();
    </script>
  </body>
</html>

